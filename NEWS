NEWS for Qvarn
==============

Version 0.73+git, not yet released
----------------------------------

* The structured log of Qvarn now includes log messages from the
  standard Python logging library. This is useful when the bottle.py
  framework or one of the library Qvarn uses emits log messags of its
  own. They now all end up in the same structured log file as Qvarn's
  own messages.

* Qvarn's HTTP responses now have a `Date:` header. Thanks to Teemu
  Kääriäinen for reporting the issue.

* A fix to `/search` by Ville Niskala. The bug caused OR conditions to
  fail if there were no corresponding rows in a joined table.

* New `/search` operators: `contains`, `startswith`, and `show`. The
  former follow the pattern of `exact`, but `show` takes a single
  parameter, which is a top-level field name and includes that field
  in the response. It may be used multiple times.

Version 0.73, released 2016-07-27
----------------------------------

Bug fixes:

* Qvarn now fails to start if its configuration lacks the fields to
  check authentication (i.e., checking the validity of access tokens).
  This means configuration files now MUST define `token_issuer` and
  `token_validation_key`. If they're not set, Qvarn doesn't start.
  This prevents accidentally running Qvarn in an insecure mode.

* The "competence type" resource is now systematically spelled with an
  underscore ("competence_types") instead of sometimes using a dash.
  This prevents much confusion and error.

Small changes:

* Manuals are now built using `qvdoc`, with Qvarn logo and everything.
  Also, Qvarn version is now used as document version.

* The single structured log message of type `critical` is now `error`,
  like all other errors.

* `slog-error` considers a HTTP status code of 400 or greater to
  indicate a failure. Previously it was 500 or greater.

* `slog-error` reports the filename from which it gets the log
  messages it reports.

* Debian packaging for Qvarn now depends on `python-yaml`.

Developer-only changes:

* Many code cleanups. Hopefully no bugs introduced (tests still pass).
  Most importantly, `src/*` are now using shared code
  (`ResourceServer`) to set up an application, based on a data
  description. The description still needs to be Python code in `src`,
  but this is a big step towards liberating Qvarn installations to
  specify the resources they need via configuration files.

* The source tree no longer has obsolete configuration file snippets.

Version 0.72, released 2016-07-05
----------------------------------

* The `/version` now reports the correct version number.

* Qvarn now uses structured logs. These are logs where each line is in
  JSON. See the `slog-pretty` and `slog-errors` utilities for reading
  such logs. Logs (in JSON) may also be sent to syslog by configuring
  main.log variable as `syslog`.

* Resources can now have a structure that is one depth deeper than
  before, and Qvarn gives an error if they're too deep. Thanks to
  Ville Niskala for reporting the problem.

Version 0.71, released 2016-05-26
----------------------------------

* Some source code cleanups have been made to placate the pylint tool.
  This should not be visible to users.

* Put back the `org.is_luotettava_kumppani_member` field, which got
  dropped earlier. A client application is using it and it's faster to
  un-break Qvarn by adding the field than to ask them to fix their
  end. We'll re-remove the field later, at a more opportune moment.

Version 0.70, released 2016-05-25
----------------------------------

* Improve speed of searches by dropping the previous approach
  (COUNT(id) turns out to be slow in Postgres) and using INNER JOIN
  instead. By Ville Niskala.

Version 0.69, released 2016-05-24
----------------------------------

* Attempt to improve the speed of search queries, by Ville Niskala.
  This version attempts to avoid unnecessary queries, and to implement
  an AND between conditions in a more efficient way. However, this
  hasn't been benchmarked yet: this release is to enable benchmarks to
  be run.

Version 0.68, released 2016-05-23
----------------------------------

* No-change release, to trigger a new build. Sorry.

Version 0.67, released 2016-05-23
----------------------------------

* Missing build dependencies added to Debian packaging.

Version 0.66, released 2016-05-23
----------------------------------

* This is the first release with a NEWS file.
